<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnuva Görüntüleme - Fikstür ve Puan Durumu</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 50%, #3B82F6 100%);
            min-height: 100vh;
        }
        .header {
            background: #1F2937;
            border-bottom: 4px solid #0686D4;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        .title-section h1 { color: white; font-size: 2.5rem; margin-bottom: 0.25rem; }
        .title-section p { color: #0686D4; font-size: 1.1rem; }
        .stats { display: flex; gap: 2rem; color: white; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #0686D4; }
        .stat-label { font-size: 0.875rem; margin-top: 0.25rem; }
        .nav { background: #2563EB; border-bottom: 2px solid #1E40AF; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; gap: 0.25rem; }
        .nav-btn {
            padding: 1.25rem 2rem;
            border: none;
            background: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .nav-btn:hover { background: rgba(37, 99, 235, 0.5); }
        .nav-btn.active { background: #1E40AF; color: #0686D4; border-bottom: 4px solid #0686D4; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1rem; }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .card-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #0686D4;
        }
        .match-card {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        .match-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .match-card.played { background: linear-gradient(135deg, #ECFDF5, #D1FAE5); border-color: #22C55E; }
        .match-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .match-info { display: flex; align-items: center; gap: 1rem; }
        .match-date { font-weight: 600; color: #374151; min-width: 100px; }
        .match-time { color: #6B7280; min-width: 60px; }
        .match-teams { display: flex; align-items: center; gap: 1rem; font-size: 1.1rem; }
        .team-name { font-weight: 600; color: #1F2937; min-width: 150px; }
        .team-home { text-align: right; }
        .score-display {
            background: #2563EB;
            color: #0686D4;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            font-size: 1.5rem;
            min-width: 100px;
            text-align: center;
        }
        .score-pending {
            background: #F3F4F6;
            color: #9CA3AF;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-style: italic;
        }
        table { width: 100%; border-collapse: collapse; }
        thead { background: linear-gradient(135deg, #2563EB, #1E40AF); color: white; }
        th, td { padding: 1rem; text-align: left; }
        th { font-weight: 600; font-size: 0.95rem; }
        tbody tr { border-bottom: 1px solid #E5E7EB; transition: all 0.2s; cursor: pointer; }
        tbody tr:hover { background: #F9FAFB; }
        .leader-row { background: linear-gradient(135deg, #FEF3C7, #FDE68A) !important; }
        .leader-row:hover { background: linear-gradient(135deg, #FDE68A, #FCD34D) !important; }
        .rank { font-weight: bold; font-size: 1.2rem; color: #6B7280; text-align: center; width: 60px; }
        .leader-row .rank { color: #D97706; }
        .team-info { display: flex; align-items: center; gap: 0.75rem; }
        .points { font-weight: bold; font-size: 1.3rem; color: #2563EB; text-align: center; }
        .hidden { display: none !important; }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .badge-success { background: #D1FAE5; color: #065F46; }
        .badge-info { background: #DBEAFE; color: #1E40AF; }
        .filter-section {
            background: #F9FAFB;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-label { font-weight: 600; color: #374151; }
        select {
            padding: 0.5rem 1rem;
            border: 2px solid #D1D5DB;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            background: white;
            cursor: pointer;
        }
        select:focus { outline: none; border-color: #2563EB; }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }
        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            background: linear-gradient(135deg, #2563EB, #1E40AF);
            color: white;
            padding: 2rem;
            border-radius: 1rem 1rem 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title { display: flex; align-items: center; gap: 1rem; }
        .modal-title h2 { font-size: 1.8rem; margin-bottom: 0.25rem; }
        .modal-title p { color: #0686D4; font-size: 1rem; }
        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .modal-close:hover { background: rgba(255, 255, 255, 0.3); }
        .modal-body { padding: 2rem; }
        .team-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-box {
            background: #F9FAFB;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 2px solid #E5E7EB;
        }
        .stat-box-label { color: #6B7280; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .stat-box-value { font-size: 1.8rem; font-weight: bold; color: #1F2937; }
        .stat-box.primary { background: linear-gradient(135deg, #DBEAFE, #BFDBFE); border-color: #2563EB; }
        .stat-box.primary .stat-box-value { color: #1E40AF; }
        .match-list-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #0686D4;
        }
        .team-match-card {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }
        .team-match-card.won { background: linear-gradient(135deg, #ECFDF5, #D1FAE5); border-color: #22C55E; }
        .team-match-card.drawn { background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-color: #FACC15; }
        .team-match-card.lost { background: linear-gradient(135deg, #FEF2F2, #FEE2E2); border-color: #EF4444; }
        .match-result-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .match-result-badge.won { background: #22C55E; color: white; }
        .match-result-badge.drawn { background: #FACC15; color: #1F2937; }
        .match-result-badge.lost { background: #EF4444; color: white; }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(31, 41, 55, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loading-content { text-align: center; color: white; }
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #0686D4;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .empty-state { text-align: center; padding: 4rem 2rem; color: #6B7280; }
        .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; }
        .error-box {
            background: #FEF2F2;
            border: 3px solid #EF4444;
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem;
            text-align: center;
        }
        .error-box h2 { color: #EF4444; margin-bottom: 1rem; }
        .error-box p { color: #374151; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem;">Turnuva Verileri Yükleniyor...</h2>
            <p style="color: #0686D4;">tournament_data.json dosyası okunuyor</p>
        </div>
    </div>

    <div class="header">
        <div class="header-content">
            <div class="title-section">
                <h1 id="tournamentTitle">Turnuva Görüntüleme</h1>
                <p id="seasonText">Veriler yükleniyor...</p>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="statMatches">0</div>
                    <div class="stat-label">Toplam Maç</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statPlayed">0</div>
                    <div class="stat-label">Oynanan</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statGoals">0</div>
                    <div class="stat-label">Toplam Gol</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statAvg">0</div>
                    <div class="stat-label">Ort. Gol</div>
                </div>
            </div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-content">
            <button class="nav-btn active" id="btnFixtures">Fikstür</button>
            <button class="nav-btn" id="btnStandings">Puan Durumu</button>
        </div>
    </div>

    <div class="container">
        <div id="contentSection">
            <!-- Fixtures Tab -->
            <div id="tab-fixtures">
                <div class="card">
                    <h2 class="card-title">Maç Fikstürü</h2>
                    <div class="filter-section">
                        <span class="filter-label">Filtrele:</span>
                        <select id="filterStatus">
                            <option value="all">Tüm Maçlar</option>
                            <option value="played">Oynanan Maçlar</option>
                            <option value="upcoming">Oynanacak Maçlar</option>
                        </select>
                        <select id="filterTeam">
                            <option value="all">Tüm Takımlar</option>
                        </select>
                    </div>
                    <div id="fixturesContent"></div>
                </div>
            </div>

            <!-- Standings Tab -->
            <div id="tab-standings" class="hidden">
                <div class="card">
                    <div style="background: linear-gradient(135deg, #2563EB, #1E40AF); color: white; padding: 1.5rem; border-radius: 0.75rem; margin: -2rem -2rem 2rem -2rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 0.5rem;">Puan Durumu</h2>
                        <p style="color: #ffffff; font-size: 1rem;">Güncel sıralama ve istatistikler - Detaylar için takıma tıklayın</p>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Sıra</th>
                                    <th>Takım</th>
                                    <th style="text-align: center;">Torba</th>
                                    <th style="text-align: center;">O</th>
                                    <th style="text-align: center;">G</th>
                                    <th style="text-align: center;">B</th>
                                    <th style="text-align: center;">M</th>
                                    <th style="text-align: center;">A</th>
                                    <th style="text-align: center;">Y</th>
                                    <th style="text-align: center;">Av</th>
                                    <th style="text-align: center;">Puan</th>
                                </tr>
                            </thead>
                            <tbody id="standingsBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="hidden">
            <div class="error-box">
                <h2>Veri Yükleme Hatası</h2>
                <p><strong>tournament_data.json</strong> dosyası bulunamadı veya okunamadı.</p>
                <button onclick="location.reload()" style="margin-top: 1.5rem; padding: 0.75rem 2rem; background: #2563EB; color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">Sayfayı Yenile</button>
            </div>
        </div>
    </div>

    <!-- Team Details Modal -->
    <div id="teamModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <div>
                        <h2 id="modalTeamName">Takım Detayları</h2>
                        <p id="modalTeamSeed"></p>
                    </div>
                </div>
                <button class="modal-close" id="modalCloseBtn">×</button>
            </div>
            <div class="modal-body">
                <div class="team-stats-grid" id="teamStatsGrid"></div>
                <h3 class="match-list-title">Maç Programı</h3>
                <div id="teamMatchesList"></div>
            </div>
        </div>
    </div>

    <script>
        let tournamentData = null;
        let allFixtures = [];
        let filteredFixtures = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadTournamentData();
            initEventListeners();
        });

        function initEventListeners() {
            document.getElementById('btnFixtures').addEventListener('click', () => showTab('fixtures'));
            document.getElementById('btnStandings').addEventListener('click', () => showTab('standings'));
            document.getElementById('filterStatus').addEventListener('change', filterFixtures);
            document.getElementById('filterTeam').addEventListener('change', filterFixtures);
            document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
            document.getElementById('teamModal').addEventListener('click', function(e) {
                if (e.target.id === 'teamModal') closeModal();
            });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeModal();
            });
        }

        function normalizeTournamentData(raw) {
            const toStr = (v) => (typeof v === 'string' ? v.trim() : v);
            const byId = new Map();
            const byName = new Map();
            let nextId = 1;
        
            if (Array.isArray(raw.teams)) {
                raw.teams.forEach(t => {
                    if (!t) return;
                    const id = typeof t.id === 'number' ? t.id : (typeof t.id === 'string' ? parseInt(t.id, 10) : undefined);
                    const name = toStr(t.name || '');
                    if (!name) return;
                    const teamObj = {
                        id: Number.isFinite(id) ? id : undefined,
                        name,
                        seed: t.seed || null
                    };
                    if (!Number.isFinite(teamObj.id)) teamObj.id = nextId++;
                    byId.set(teamObj.id, teamObj);
                    byName.set(name.toLowerCase(), teamObj);
                    if (teamObj.id >= nextId) nextId = teamObj.id + 1;
                });
            }
        
            function ensureTeam(val) {
                if (val && typeof val === 'object') {
                    const name = toStr(val.name || '');
                    let id = val.id;
                    if (!Number.isFinite(id)) {
                        if (name && byName.has(name.toLowerCase())) {
                            id = byName.get(name.toLowerCase()).id;
                        } else {
                            id = nextId++;
                        }
                    }
                    let existing = byId.get(id);
                    if (!existing) {
                        existing = { id, name, seed: val.seed || null };
                        byId.set(id, existing);
                        if (name) byName.set(name.toLowerCase(), existing);
                    } else {
                        existing.name = existing.name || name;
                        existing.seed = existing.seed !== null ? existing.seed : (val.seed || null);
                        if (existing.name && !byName.has(existing.name.toLowerCase())) {
                            byName.set(existing.name.toLowerCase(), existing);
                        }
                    }
                    return existing;
                }
        
                if (typeof val === 'string') {
                    const name = val.trim();
                    if (name) {
                        const key = name.toLowerCase();
                        if (byName.has(key)) return byName.get(key);
                        const t = { id: nextId++, name, seed: null };
                        byId.set(t.id, t);
                        byName.set(key, t);
                        return t;
                    }
                }
        
                if (Number.isFinite(val)) {
                    if (byId.has(val)) return byId.get(val);
                    const t = { id: val, name: `Team ${val}`, seed: null };
                    byId.set(val, t);
                    byName.set(t.name.toLowerCase(), t);
                    if (val >= nextId) nextId = val + 1;
                    return t;
                }
        
                const t = { id: nextId++, name: `Team ${nextId - 1}`, seed: null };
                byId.set(t.id, t);
                byName.set(t.name.toLowerCase(), t);
                return t;
            }
        
            const fixtures = (raw.fixtures || []).map((f, i) => {
                const home = ensureTeam(f.homeTeam ?? f.home ?? f.homeTeamName);
                const away = ensureTeam(f.awayTeam ?? f.away ?? f.awayTeamName);
                return {
                    id: f.id ?? (Date.now() + i),
                    round: f.round ?? null,
                    date: f.date ?? '',
                    time: f.time ?? '',
                    homeTeam: home,
                    awayTeam: away,
                    played: !!f.played,
                    homeScore: f.homeScore ?? null,
                    awayScore: f.awayScore ?? null
                };
            });
        
            const teams = Array.from(byId.values()).sort((a, b) => a.id - b.id);
        
            return {
                tournamentName: raw.tournamentName || 'Turnuva',
                season: raw.season || '2024-25',
                matchesPerTeam: raw.matchesPerTeam ?? null,
                teams,
                fixtures,
                exportDate: raw.exportDate || null,
                totalMatches: fixtures.length
            };
        }
        
        async function loadTournamentData() {
            const loadingElement = document.getElementById("loadingOverlay");
            const contentElement = document.getElementById("contentSection");
            const errorElement = document.getElementById("errorSection");
        
            try {
                const res = await fetch("tournament_data.json?" + Date.now());
                if (!res.ok) throw new Error("tournament_data.json bulunamadı veya okunamadı.");
                const raw = await res.json();
        
                const normalized = normalizeTournamentData(raw);
        
                tournamentData = normalized;
                allFixtures = normalized.fixtures.slice();
                filteredFixtures = allFixtures.slice();
        
                document.getElementById("tournamentTitle").textContent = normalized.tournamentName || "Turnuva Görüntüleme";
                document.getElementById("seasonText").textContent = (normalized.season || "2025") + " Sezonu";
        
                const teamSelect = document.getElementById("filterTeam");
                teamSelect.innerHTML = '<option value="all">Tüm Takımlar</option>';
                normalized.teams.forEach(t => {
                    teamSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
                });
        
                updateStats();
                filterFixtures();
                renderStandings();
        
                loadingElement.style.display = "none";
                contentElement.style.display = "block";
                errorElement.classList.add("hidden");
        
            } catch (err) {
                console.error("Yükleme hatası:", err);
                if (loadingElement) loadingElement.style.display = "none";
                if (errorElement) errorElement.classList.remove("hidden");
                alert("Turnuva verileri yüklenemedi:\n" + err.message);
            }
        }

        function showTab(tab) {
            document.getElementById('tab-fixtures').classList.toggle('hidden', tab !== 'fixtures');
            document.getElementById('tab-standings').classList.toggle('hidden', tab !== 'standings');
            
            document.getElementById('btnFixtures').classList.toggle('active', tab === 'fixtures');
            document.getElementById('btnStandings').classList.toggle('active', tab === 'standings');
        }

        function updateStats() {
            const played = allFixtures.filter(f => f.played).length;
            const goals = allFixtures.filter(f => f.played).reduce((sum, f) => 
                sum + (f.homeScore || 0) + (f.awayScore || 0), 0
            );
            const avg = played > 0 ? (goals / played).toFixed(2) : 0;

            document.getElementById('statMatches').textContent = allFixtures.length;
            document.getElementById('statPlayed').textContent = played;
            document.getElementById('statGoals').textContent = goals;
            document.getElementById('statAvg').textContent = avg;
        }

        function filterFixtures() {
            const status = document.getElementById('filterStatus').value;
            const teamId = parseInt(document.getElementById('filterTeam').value);

            filteredFixtures = allFixtures.filter(f => {
                let statusMatch = true;
                if (status === 'played') statusMatch = f.played;
                if (status === 'upcoming') statusMatch = !f.played;

                let teamMatch = true;
                if (teamId && !isNaN(teamId)) {
                    teamMatch = f.homeTeam.id === teamId || f.awayTeam.id === teamId;
                }

                return statusMatch && teamMatch;
            });

            renderFixtures();
        }

        function renderFixtures() {
            const content = document.getElementById('fixturesContent');
            
            if (filteredFixtures.length === 0) {
                content.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📋</div><h3>Maç Bulunamadı</h3></div>';
                return;
            }

            let html = '<div style="max-height: 700px; overflow-y: auto;">';
            let currentRound = 0;
            
            filteredFixtures.forEach(f => {
                if (f.round && f.round !== currentRound) {
                    currentRound = f.round;
                    html += `<div style="background: linear-gradient(135deg, #2563EB, #1E40AF); color: white; padding: 1rem 1.5rem; border-radius: 0.75rem; margin: 1.5rem 0 1rem 0; font-weight: bold; font-size: 1.2rem;">🏆 ${currentRound}. TUR</div>`;
                }
                
                html += `
                    <div class="match-card ${f.played ? 'played' : ''}">
                        <div class="match-row">
                            <div class="match-info">
                                ${f.played ? '<span class="badge badge-success">✓ Oynanmış</span>' : '<span class="badge badge-info">Oynanacak</span>'}
                                ${f.round ? `<span class="badge" style="background: #DBEAFE; color: #1E40AF;">Tur ${f.round}</span>` : ''}
                                <span class="match-date">${f.date}</span>
                                <span class="match-time">${f.time}</span>
                            </div>
                            <div class="match-teams">
                                <span class="team-name team-home">${f.homeTeam.name}</span>
                                ${f.played ? `<div class="score-display">${f.homeScore} - ${f.awayScore}</div>` : `<div class="score-pending">vs</div>`}
                                <span class="team-name">${f.awayTeam.name}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function renderStandings() {
            const standings = {};
            
            tournamentData.teams.forEach(team => {
                standings[team.id] = {
                    team: team, played: 0, won: 0, drawn: 0, lost: 0,
                    goalsFor: 0, goalsAgainst: 0, goalDifference: 0, points: 0
                };
            });

            allFixtures.forEach(f => {
                if (f.played && f.homeScore !== null && f.awayScore !== null) {
                    const home = standings[f.homeTeam.id];
                    const away = standings[f.awayTeam.id];

                    home.played++; away.played++;
                    home.goalsFor += f.homeScore;
                    home.goalsAgainst += f.awayScore;
                    away.goalsFor += f.awayScore;
                    away.goalsAgainst += f.homeScore;

                    if (f.homeScore > f.awayScore) {
                        home.won++; home.points += 3; away.lost++;
                    } else if (f.homeScore < f.awayScore) {
                        away.won++; away.points += 3; home.lost++;
                    } else {
                        home.drawn++; away.drawn++;
                        home.points++; away.points++;
                    }

                    home.goalDifference = home.goalsFor - home.goalsAgainst;
                    away.goalDifference = away.goalsFor - away.goalsAgainst;
                }
            });

            const sorted = Object.values(standings).sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                return b.goalsFor - a.goalsFor;
            });

            const tbody = document.getElementById('standingsBody');
            tbody.innerHTML = '';
            
            sorted.forEach((s, i) => {
                const row = tbody.insertRow();
                row.addEventListener('click', () => showTeamDetails(s.team));
                
                let rankBgColor;
                if (i < 8) rankBgColor = '#DCFCE7'; // 1-8: açık yeşil
                else if (i < 16) rankBgColor = '#DBEAFE'; // 9-16: açık mavi
                else if (i < 24) rankBgColor = '#6ea8f5'; // 17-24: koyu mavi
                else rankBgColor = '#ff4545'; // 25+: açık kırmızı
                
                row.innerHTML = `
                    <td class="rank" style="background: ${rankBgColor}; color: #1F2937; font-weight: 700;">${i + 1}</td>
                    <td>
                        <div class="team-info">
                            <div>
                                <strong style="color: #1F2937; font-size: 1.05rem;">${s.team.name}</strong>
                            </div>
                        </div>
                    </td>
                    <td style="text-align: center; font-weight: 600; color: #0686D4;">#${s.team.seed || '-'}</td>
                    <td style="text-align: center;">${s.played}</td>
                    <td style="text-align: center; color: #22C55E; font-weight: 600;">${s.won}</td>
                    <td style="text-align: center; color: #FACC15; font-weight: 600;">${s.drawn}</td>
                    <td style="text-align: center; color: #EF4444; font-weight: 600;">${s.lost}</td>
                    <td style="text-align: center; font-weight: 600;">${s.goalsFor}</td>
                    <td style="text-align: center; font-weight: 600;">${s.goalsAgainst}</td>
                    <td style="text-align: center; font-weight: bold; color: ${s.goalDifference >= 0 ? '#22C55E' : '#EF4444'};">
                        ${s.goalDifference > 0 ? '+' : ''}${s.goalDifference}
                    </td>
                    <td class="points">${s.points}</td>
                `;
            });
        }

        function showTeamDetails(team) {
            document.getElementById('modalTeamName').textContent = team.name;
            document.getElementById('modalTeamSeed').textContent = team.seed ? `Torba #${team.seed}` : 'Torba: -';
            
            const teamMatches = allFixtures.filter(f => f.homeTeam.id === team.id || f.awayTeam.id === team.id);
            const playedMatches = teamMatches.filter(f => f.played);
            let wins = 0, draws = 0, losses = 0, goalsFor = 0, goalsAgainst = 0;

            playedMatches.forEach(f => {
                const isHome = f.homeTeam.id === team.id;
                const teamScore = isHome ? f.homeScore : f.awayScore;
                const oppScore = isHome ? f.awayScore : f.homeScore;
                
                goalsFor += teamScore;
                goalsAgainst += oppScore;
                
                if (teamScore > oppScore) wins++;
                else if (teamScore === oppScore) draws++;
                else losses++;
            });

            const goalDiff = goalsFor - goalsAgainst;
            const points = wins * 3 + draws;
            const winRate = playedMatches.length > 0 ? ((wins / playedMatches.length) * 100).toFixed(0) : 0;

            document.getElementById('teamStatsGrid').innerHTML = `
                <div class="stat-box primary"><div class="stat-box-label">Puan</div><div class="stat-box-value">${points}</div></div>
                <div class="stat-box"><div class="stat-box-label">Oynanan</div><div class="stat-box-value">${playedMatches.length}</div></div>
                <div class="stat-box"><div class="stat-box-label">Galibiyet</div><div class="stat-box-value" style="color: #22C55E;">${wins}</div></div>
                <div class="stat-box"><div class="stat-box-label">Beraberlik</div><div class="stat-box-value" style="color: #FACC15;">${draws}</div></div>
                <div class="stat-box"><div class="stat-box-label">Mağlubiyet</div><div class="stat-box-value" style="color: #EF4444;">${losses}</div></div>
                <div class="stat-box"><div class="stat-box-label">Atılan Gol</div><div class="stat-box-value">${goalsFor}</div></div>
                <div class="stat-box"><div class="stat-box-label">Yenilen Gol</div><div class="stat-box-value">${goalsAgainst}</div></div>
                <div class="stat-box"><div class="stat-box-label">Averaj</div><div class="stat-box-value" style="color: ${goalDiff >= 0 ? '#22C55E' : '#EF4444'};">${goalDiff > 0 ? '+' : ''}${goalDiff}</div></div>
                <div class="stat-box"><div class="stat-box-label">Galibyet Oranı</div><div class="stat-box-value">${winRate}%</div></div>
            `;

            let html = '';
            let currentRound = 0;
            
            teamMatches.forEach(match => {
                if (match.round && match.round !== currentRound) {
                    currentRound = match.round;
                    html += `<div style="background: linear-gradient(135deg, #2563EB, #1E40AF); color: white; padding: 0.75rem 1rem; border-radius: 0.5rem; margin: 1rem 0 0.75rem 0; font-weight: bold; text-align: center;">🏆 ${currentRound}. TUR</div>`;
                }
                
                const isHome = match.homeTeam.id === team.id;
                const opponent = isHome ? match.awayTeam : match.homeTeam;
                const teamScore = isHome ? match.homeScore : match.awayScore;
                const oppScore = isHome ? match.awayScore : match.homeScore;
                
                let resultClass = '', resultBadge = '', resultText = '';
                
                if (match.played) {
                    if (teamScore > oppScore) {
                        resultClass = 'won'; resultBadge = 'won'; resultText = 'Galibiyet';
                    } else if (teamScore === oppScore) {
                        resultClass = 'drawn'; resultBadge = 'drawn'; resultText = 'Beraberlik';
                    } else {
                        resultClass = 'lost'; resultBadge = 'lost'; resultText = 'Mağlubiyet';
                    }
                }

                html += `
                    <div class="team-match-card ${resultClass}">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                ${match.played ? `<span class="match-result-badge ${resultBadge}">${resultText}</span>` : '<span class="badge badge-info">Oynanacak</span>'}
                                ${match.round ? `<span class="badge" style="background: #DBEAFE; color: #1E40AF;">Tur ${match.round}</span>` : ''}
                                <span style="font-weight: 600; color: #374151;">${match.date}</span>
                                <span style="color: #6B7280;">${match.time}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; font-size: 1.1rem;">
                                <span style="font-weight: 600; color: #1F2937;">${isHome ? '🏠' : '✈️'} ${isHome ? 'vs' : '@'} ${opponent.name}</span>
                                <span style="color: #0686D4; font-weight: 600;">(Torba #${opponent.seed || '-'})</span>
                                ${match.played ? 
                                    `<div style="background: #2563EB; color: #0686D4; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: bold; font-size: 1.2rem;">${isHome ? teamScore : oppScore} - ${isHome ? oppScore : teamScore}</div>` :
                                    '<div style="background: #F3F4F6; color: #9CA3AF; padding: 0.5rem 1rem; border-radius: 0.5rem;">vs</div>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('teamMatchesList').innerHTML = html;
            document.getElementById('teamModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('teamModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    </script>
</body>
</html>
